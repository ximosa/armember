!function(a){"use strict";function b(){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a}function c(){a("#mp-demo-test-email").click(function(){var c=a('input[name="test-email-receiver"]');if(""!=c.val()){var d=a(".mp-admin-settings-email-form"),e=a(".mp-message",d),f=a(".spinner",d),g=d.serializeObject(),h={};h.security=MP_Demo_Ajax.security,h.mp_demo_action="send_response",h.controller="mail",h.mp_demo_url=window.location.href,h.mp_subtab=b().subtab,h.mp_subtab="undefined"!==h.mp_subtab?h.mp_subtab:"to-customer",f.addClass("is-active"),g=a.extend(!0,g,h),delete g.mp_demo_save,delete g.action,k(g,function(b){b&&(b.success===!0?(a(".mp-demo-success",e).fadeIn(),setTimeout(function(){a(".mp-demo-success",e).fadeOut()},5e3)):(a(".mp-demo-fail",e).fadeIn(),"undefined"!==b.errors&&a(".mp-demo-fail",e).find(".mp-errors").text(b.errors),setTimeout(function(){a(".mp-demo-fail",e).fadeOut()},5e3)),e.fadeIn()),f.removeClass("is-active"),c.val("")},function(a){console.log("Error ",a),f.removeClass("is-active")})}})}function d(){jQuery(".upload_image_button").mpDemoImageUpload()}function e(){var b=a("#mp_add_table_item"),c=a("#mp_cancel_table_editing"),d={link_id:a("#select-link_id"),text:a("#select-text"),link:a("#select-link"),btn_text:a("#select-btn_text"),btn_url:a("#select-btn_url"),btn_class:a("#select-btn_class"),img:a("#select-img")},e=a("#mp-source-select-items").find("tbody");a.fn.sortable&&e.sortable({items:"tr",cursor:"move",opacity:.95}),b.click(function(){var c=m(d),f=a(this).parent().find(".spinner"),g=a(this).attr("data-action");if(a(f).addClass("is-active"),"edit"===g){var h=a(this).attr("data-id");p(d,c,h),b.val(MP_Demo_Ajax.add_text),b.attr("data-action","add"),b.attr("data-id",-1),a(f).removeClass("is-active")}else{var i={mp_demo_action:"add_row",controller:"toolbar",data:c};k(i,function(b){a(".mp-demo-no-rows-message").hide(),e.append(b.data),a(f).removeClass("is-active"),a("tr",e).removeClass("active")},function(b){console.log("Error ",b),a(f).removeClass("is-active"),a("tr",e).removeClass("active")})}}),c.click(function(){var c=a(this).parent().find(".spinner");l(d),a("tr",e).removeClass("active"),b.attr("data-action","add"),b.attr("data-id",-1),b.val(MP_Demo_Ajax.add_text),a(c).removeClass("is-active")}),e.delegate(".edit-event-button","click",function(c){var f=a(this).attr("data-id"),g=a(this).parent().find(".view-event-button"),h=o(d,f);return a("tr",e).removeClass("active"),a('tr[data-id="'+f+'"]',e).addClass("active"),n(d,h),b.val(MP_Demo_Ajax.update_text),b.attr("data-action","edit"),b.attr("data-id",f),g.remove(),c.preventDefault(),!1}),e.delegate(".delete-event-button","click",function(b){var c=a(this).attr("data-id"),d=e.find("tr[data-id='"+c+"']");return d.after("<tr></tr>").hide(),d.empty(),a("tr",e).removeClass("active"),b.preventDefault(),!1})}function f(){var b=a("#mp-demo-export-sandbox"),c=a("#mp-demo-add-replacement"),d=a("#mp-demo-export-info-wrap"),e=a("#mp-replacements-table").find("tbody");a.fn.sortable&&e.sortable({items:"tr",cursor:"move",opacity:.95}),c.click(function(){var b=a(this).parent().find(".spinner");b=a(b),b.addClass("is-active");var c={mp_demo_action:"add_row",controller:"sandbox"};k(c,function(c){a(".mp-demo-no-rows-message").hide(),e.append(c.data),b.removeClass("is-active"),a("tr",e).removeClass("active")},function(c){console.log("Error ",c),b.removeClass("is-active"),a("tr",e).removeClass("active")})}),e.delegate(".mp-demo-symbol-delete","click",function(b){var c=a(this).parent().parent();return c.empty(),!1}),a("#mp-demo-export-info-wrap").delegate("#mp-demo-remove-export-files","click",function(b){b.preventDefault();var c=a(this).parent().find(".spinner"),e={};e.security=MP_Demo_Ajax.security,e.controller="sandbox",e.mp_demo_action="remove_export",e.source_path=a(this).attr("data-export"),c=a(c),c.addClass("is-active"),k(e,function(a){d.append(a.data.html),c.removeClass("is-active")},function(a){console.log("Error ",a),c.removeClass("is-active")})}),a(':input[type!="submit"]',b.get(0)).live("change",function(c){0==a('input[type="checkbox"]:checked',b).length?b.find(':input[type="submit"]').attr("disabled","disabled"):b.find(':input[type="submit"]').removeAttr("disabled")}),b.submit(function(c){c.preventDefault();var e=a(this).serializeObject(),f=a(".spinner",".submit");return f.addClass("is-active"),e.security=MP_Demo_Ajax.security,e.controller="sandbox",a("input",b).attr("disabled",!0),e.mp_demo_action="export_tables",k(e,function(a){d.append(a.data.html),e.mp_demo_action="apply_replacements",e.sql_file=a.data.sql_file,e.blog_export_folder=a.data.blog_export_folder,e.tables_count=a.data.tables_count,k(e,function(a){d.append(a.data.html),e.mp_demo_action="export_uploads",k(e,function(a){d.append(a.data.html),e.mp_demo_action="create_zip",k(e,function(a){d.append(a.data.html),f.removeClass("is-active")},function(a){console.log("Error ",a),f.removeClass("is-active")})},function(a){console.log("Error ",a),f.removeClass("is-active")})},function(a){console.log("Error ",a),f.removeClass("is-active")})},function(a){console.log("Error ",a),f.removeClass("is-active")}),!1})}function g(){a(".mp-admin-restrict").delegate(".mp-demo-parent","change",function(){var b=a(this).closest(".mp-parent-div").find('input[type="checkbox"]');this.checked?b.attr("checked","checked"):b.removeAttr("checked")})}function h(){var b=a(".mp-demo-lifetime-wrap"),c=a('input[name="settings[is_lifetime]"]:checked',b).val();i(b,c),a('input[name="settings[is_lifetime]"]',b).on("click",function(){i(b,a(this).val())})}function i(b,c){1==c?(a('input[name="settings[expiration_duration]"]',b).attr("disabled","disabled"),a('select[name="settings[expiration_measure]"]',b).attr("disabled","disabled")):(a('input[name="settings[expiration_duration]"]',b).removeAttr("disabled"),a('select[name="settings[expiration_measure]"]',b).removeAttr("disabled"))}function j(){if("function"==typeof a().datepicker){var b=new Date(2e3,9,25),c=b;a("#mp-demo-datepicker-start").datepicker({minDate:b,dateFormat:"yy-mm-dd",onSelect:function(a,b){c=a}}),a("#mp-demo-datepicker-end").datepicker({dateFormat:"yy-mm-dd",beforeShowDay:function(b){var c=a.datepicker.formatDate("yy-mm-dd",b);return[a("#mp-demo-datepicker-start").val()<=c]}})}}a.fn.serializeObject=function(){var b={},c=this.serializeArray();return a.each(c,function(){b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""}),b},a.fn.mpDemoImageUpload=function(){return this.each(function(b,c){var d,e=a(this).closest("td");a(c).bind("click",function(b){return b.preventDefault(),d?void d.open():(d=wp.media.frames.file_frame=wp.media({title:a(this).data("uploader_title"),button:{text:a(this).data("uploader_button_text")},library:{type:"image"},multiple:!1}),d.on("select",function(){var b=d.state().get("selection").first().toJSON(),c=a(e.find(".upload_image_preview"));b=b.url,e.find(".mp_logo_url").val(b),c.show(),c.find("img").attr("src",b)}),void d.open())})})},a.fn.mpDemoTabNav=function(){return this.each(function(b,c){a(c).on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(b.target),d=a(c).attr("href");a(".mp-demo-nav-tabs a").removeClass("nav-tab-active"),a(c).addClass("nav-tab-active"),a("div[id^='mp-demo-nav-tab-']").css("display","none"),a(d).fadeIn()})})};var k=function(b,c,d){b.action="route_url",a.ajax({url:MP_Demo_Ajax.url,type:"POST",data:b,success:function(a){c(a)},error:function(a,b){d(a)}})},l=function(b){for(var c in b)a(b[c]).val("");a("#mp-source-select-items .upload_image_preview").hide()},m=function(a){var b={};for(var c in a)b[c]=a[c].val();return l(a),b},n=function(b,c){for(var d in b)a(b[d]).val(c[d])},o=function(b,c){var d={};for(var e in b)d[e]=a("input[name='settings[select]["+c+"]["+e+"]']").val();return l(b),d},p=function(b,c,d){var e=c.link_id,f=a("#mp-source-select-items"),g=f.find("tr[data-id='"+d+"']");for(var h in b){var i=f.find("input[name='settings[select]["+d+"]["+h+"]']");i.val(c[h]),i.attr("name","settings[select]["+e+"]["+h+"]"),"img"===h?g.find("td.select-"+h+" img").attr("src",c[h]):g.find("td.select-"+h).text(c[h])}g.find(".delete-event-button").attr("data-id",e),g.find(".edit-event-button").attr("data-id",e),g.attr("data-id",e)};a(document).ready(function(){"toolbar"===b().tab&&(a(".mp-demo-colorpicker").wpColorPicker({defaultColor:!1}),e()),a(".mp-demo-nav-tabs a").mpDemoTabNav(),c(),d(),g(),h(),j(),f()})}(jQuery);